<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BetSpread – Supabase test</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; line-height: 1.6; }
    input { display:block; margin:8px 0; padding:8px; width:100%; max-width:400px; }
    button { padding:8px 12px; margin:4px 0; }
    ul { padding-left: 20px; }
    .card { border:1px solid #ddd; padding: 16px; margin-bottom:24px; border-radius:8px; }
  </style>
</head>
<body>
  <h1>BetSpread – Supabase demo</h1>

  <div class="card">
    <h2>Autentisering</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Lösenord">
    <button onclick="signup()">Skapa konto</button>
    <button onclick="login()">Logga in</button>
    <button onclick="logout()">Logga ut</button>
  </div>

  <div class="card">
    <h2>Projekt</h2>
    <input id="projname" placeholder="Projektnamn">
    <button onclick="createProject()">Skapa projekt</button>
    <h3>Mina projekt:</h3>
    <ul id="projects"></ul>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://updpywjfxeahtjpelbku.supabase.co";
    const SUPABASE_KEY = "sb_publishable_GB6f7XXePLTeIVIJYGjODg_rRlKqi4B";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const { error } = await supabase.auth.signUp({ email, password });
      if (error) alert("Fel: " + error.message);
      else alert("Konto skapat! Kolla din mail för verifiering (om aktiverat).");
    }

    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) alert("Fel: " + error.message);
      else {
        alert("Inloggad!");
        loadProjects();
      }
    }

    async function logout() {
      await supabase.auth.signOut();
      alert("Utloggad!");
      document.getElementById("projects").innerHTML = "";
    }

    async function createProject() {
      const { data: user } = await supabase.auth.getUser();
      if (!user) { alert("Du måste vara inloggad för att skapa projekt."); return; }
      const name = document.getElementById("projname").value;
      if (!name) { alert("Fyll i projektnamn."); return; }
      const { error } = await supabase.from("projects").insert({ user_id: user.id, name });
      if (error) alert("Fel: " + error.message);
      else {
        alert("Projekt skapat!");
        document.getElementById("projname").value = "";
        loadProjects();
      }
    }

    async function loadProjects() {
      const { data: user } = await supabase.auth.getUser();
      if (!user) return;
      const { data, error } = await supabase.from("projects").select("*").eq("user_id", user.id);
      if (error) { alert("Fel: " + error.message); return; }
      const list = document.getElementById("projects");
      list.innerHTML = data.map(p => `<li>${p.name} (ID: ${p.id})</li>`).join("");
    }

    // Håll användarrollen uppdaterad
    supabase.auth.onAuthStateChange((event, session) => {
      if (session) loadProjects();
      else document.getElementById("projects").innerHTML = "";
    });

    // Om redan inloggad
    supabase.auth.getSession().then(res => {
      if (res.data.session) loadProjects();
    });
  </script>
</body>
</html>
